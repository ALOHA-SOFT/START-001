<th:block th:fragment="popup">
  
  <!-- 메인 팝업 3:4 모달 (Swiper 슬라이드) -->
  <th:block th:if="${mainPopups != null and !#lists.isEmpty(mainPopups)}">
    <div class="modal" id="mainPopupModal" tabindex="-1" aria-labelledby="mainPopupModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered d-flex justify-content-center" style="max-width:400px; margin: 0 auto;">
        <div class="modal-content" style="border-radius:1rem; overflow:hidden;">
          <div class="modal-body p-0" style="background:#000;">
            <div class="swiper main-popup-swiper" style="width:100%; aspect-ratio:3/4; background:#000;">
              <div class="swiper-wrapper">
                <th:block th:each="popup : ${mainPopups}">
                  <div class="swiper-slide d-flex flex-column justify-content-center align-items-center" style="background:#000;">
                    <a th:if="${popup.link != null && popup.link != ''}" th:href="${popup.link}" target="_blank" style="display:block;width:100%;height:100%;">
                      <img th:src="${popup.url != null ? popup.url : 'https://placehold.co/400x530?text=Popup'}" th:alt="${popup.name != null ? popup.name : '기본 배너 이미지'}" style="width:100%;height:100%;object-fit:cover;" />
                    </a>
                    <img th:if="${popup.link == null || popup.link == ''}" th:src="${popup.url != null ? popup.url : 'https://placehold.co/400x530?text=Popup'}" th:alt="${popup.name != null ? popup.name : '기본 배너 이미지'}" style="width:100%;height:100%;object-fit:cover;" />
                  </div>
                </th:block>
              </div>
              <div class="swiper-pagination"></div>
            </div>
          </div>
          <div class="modal-footer justify-content-between align-items-center bg-light py-2 px-3">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="1" id="dontShowToday">
              <label class="form-check-label small cursor-pointer" for="dontShowToday">오늘 하루 보지 않기</label>
            </div>
            <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal" id="closePopupModal">닫기</button>
          </div>
        </div>
      </div>
    </div>
  </th:block>


    <script>
    // 쿠키 유틸
    function setCookie(name, value, hours) {
      var d = new Date();
      d.setTime(d.getTime() + (hours*60*60*1000));
      document.cookie = name + '=' + value + ';expires=' + d.toUTCString() + ';path=/';
    }
    function getCookie(name) {
      var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
      return v ? v[2] : null;
    }

    document.addEventListener('DOMContentLoaded', function() {
      var hasPopups = [[${mainPopups != null and !#lists.isEmpty(mainPopups)}]];
      if (hasPopups && !getCookie('hideMainPopup')) {
        var popupModal = new bootstrap.Modal(document.getElementById('mainPopupModal'));
        popupModal.show();
      }
      // Swiper for popup
      if (hasPopups) {
        new Swiper('.main-popup-swiper', {
          loop: true,
          pagination: { el: '.main-popup-swiper .swiper-pagination', clickable: true },
          autoplay: { delay: 2500, disableOnInteraction: false },
        });
      }
      // 오늘 하루 보지 않기
      document.getElementById('dontShowToday')?.addEventListener('change', function(e) {
        if (e.target.checked) {
          setCookie('hideMainPopup', '1', 24); // 24시간
        } else {
          setCookie('hideMainPopup', '', -1); // 삭제
        }
      });
      // 모달 닫힐 때 체크되어 있으면 쿠키 저장
      document.getElementById('mainPopupModal')?.addEventListener('hidden.bs.modal', function() {
        if (document.getElementById('dontShowToday')?.checked) {
          setCookie('hideMainPopup', '1', 24);
        }
      });
    });
  </script>

  <style>
    .cursor-pointer {
      cursor: pointer;
    }
    
    #mainPopupModal .modal-content {
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }
    
    .main-popup-swiper .swiper-pagination-bullet {
      background: rgba(255, 255, 255, 0.7);
    }
    
    .main-popup-swiper .swiper-pagination-bullet-active {
      background: #fff;
    }
  </style>


</th:block>